<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Operator</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimal-ui">
    <meta name="mobile-web-app-capable" content="yes">
    <link href='http://fonts.googleapis.com/css?family=Bitter:700|Open+Sans:400,400italic' rel='stylesheet' type='text/css'>
    <link href="static/css/style.css" media="all" rel="stylesheet" type="text/css" />
  </head>
  <body id="top">


    <header id="header" itemscope itemtype="http://schema.org/Organization">
      <h1 itemprop="name">Operator</h1>
      <h2 itemprop="description">Need me to call someone for you?<br/>I'll wait on hold and then let you know when it's time to talk to a real human being.</h2>
    </header>

    <div class="wrapper">

      <form id="app" class="animated fadeIn">
        <ul class="form-fields">
           <li>
              <label>Who can I call for you?</label>
              <input type="text" name="input-name" id="input-name" class="input text-input typeahead" placeholder="Type name or number&hellip;"/>
              <small class="extra-help"><a class="next"><span class="entypo chevron-right"></a></small>
           </li>
           <li>
              <label>What language do you speak?</label>
              <input type="text" name="1" class="input text-input" placeholder="English&hellip;"/>
              <small class="extra-help"><a class="next"><span class="entypo chevron-right"></span></a></small>
           </li>
           <li>
              <label>And what seems to be the problem?</label>
              <textarea class="input" name="input-problem" placeholder="Type a full sentance."></textarea>
              <small class="extra-help"><a class="next"><span class="entypo chevron-right"></span></a></small>
           </li>
           <li>
              <label>What's your number?</label>
              <input type="text" name="input-number" class="input " placeholder="+1 (xxx) xxx-xxxx"/>
              <small class="extra-help"><a class="next"><span class="entypo chevron-right"></span></a></small>
           </li>
           <li>
              <label>Where should I email the transcript?</label>
              <input type="text" name="input-email" class="input " placeholder="your-email@example.com"/>
              <small class="extra-help"><a class="next"><span class="entypo chevron-right"></span></a></small>
           </li>
        </ul>
        <a class="btn" id="submit">Dope!</a>
      </form>

    </div><!-- .wrapper -->    

    <footer class="animated fadeIn">
      <p>Made by <a href="http://theopak.com">Theo Pak</a> &amp; <a href="http://derek-schultz.net">Derek Schultz</a>.</p>
    </footer>


    <script src="static/js/jquery-1.11.0.min.js" charset="utf-8"></script>
    <script src="static/js/jquery.smooth-scroll.min.js" charset="utf-8"></script>
    <script src="static/js/typeahead.bundle.min.js" charset="utf-8"></script>
    <script>

      // Temporary
      var substringMatcher = function(strs) {
        return function findMatches(q, cb) {
          var matches, substringRegex;
       
          // an array that will be populated with substring matches
          matches = [];
       
          // regex used to determine if a string contains the substring `q`
          substrRegex = new RegExp(q, 'i');
       
          // iterate through the pool of strings and for any string that
          // contains the substring `q`, add it to the `matches` array
          $.each(strs, function(i, str) {
            if (substrRegex.test(str)) {
              // the typeahead jQuery plugin expects suggestions to a
              // JavaScript object, refer to typeahead docs for more info
              matches.push({ value: str });
            }
          });
       
          cb(matches);
        };
      };
      var states = ['Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California',
        'Colorado', 'Connecticut', 'Delaware', 'Florida', 'Georgia', 'Hawaii',
        'Idaho', 'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana',
        'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota',
        'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire',
        'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota',
        'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'Rhode Island',
        'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont',
        'Virginia', 'Washington', 'West Virginia', 'Wisconsin', 'Wyoming'
      ];
      var companies = new Bloodhound({
        datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
        queryTokenizer: Bloodhound.tokenizers.whitespace,
        remote: '/companies/search/%QUERY'
      });
       
      // Typeahead
      companies.initialize();
      $('#input-name').typeahead({
        minLength: 1,
        highlight: true,
      },
      {
        name: 'companies',
        displayKey: 'name',
        source: companies.ttAdapter()
      });

      // via http://jsfiddle.net/sxGtM/3/
      $.fn.serializeObject = function(){
        var o = {};
        var a = this.serializeArray();
        $.each(a, function() {
          if (o[this.name] !== undefined) {
            if (!o[this.name].push) {
                o[this.name] = [o[this.name]];
            }
            o[this.name].push(this.value || '');
          } else {
            o[this.name] = this.value || '';
          }
        });
        return o;
      };

      $(document).ready(function(){

        // Faster scrolling
        //   via <thecssninja.com/javascript/pointer-events-60fps>.
        var body = document.body, timer;
        window.addEventListener('scroll', function(){
          clearTimeout(timer);
          if(!body.classList.contains('disable-hover'))
            body.classList.add('disable-hover')
          timer = setTimeout(function(){
            body.classList.remove('disable-hover')
          }, 500);
        }, false);

        // Internal Link Smooth Scroll
        $('a').smoothScroll({
          offset: -50
        });

        // Focus forward/back
        $('.form-fields .input').on('focus', function(e){
          $(this).parent().addClass('active');
        });
        $('.form-fields .input').on('blur', function(e){
          $(this).parent().removeClass('active');
        });
        $('.form-fields label').on('click', function(e){
          console.log('yup');
          $(this).next('.input').focus();
        });
        $('.form-fields .next').on('click', function(e){
          $(this).parent().parent().next('li').find('.input').focus();
        });
        $('.form-fields .input').bind('keyup', function(e){
          // Use [Up] and [Enter, Down]
          //   to iterative the form appropriately
          if(e.keyCode==38) {
            $(this).parent().prev('li').find('.input').focus();
          } else if(e.keyCode==13 || e.keyCode==40) {
            $(this).parent().next('li').find('.input').focus();
          } 
        });

        // Submit data
        $('#submit').on('click', function(e){

          // Build the payload
          var payload = JSON.stringify( $('form#app').serializeObject() );

          // POST jqXHR
          var jqxhr = $.ajax({
            type: 'POST',
            url: '/outbound/new',
            data: payload,
            cache: false
          })
          .done(function() {
            console.log('done');
          })
          .fail(function() {
            console.log('fail');
          })
          .always(function() {
            console.log(payload);
          });

        });

        // Select first form
        $('.form-fields .input').first().focus();

      });

      // Google Analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-10935216-9', 'happyoperator.com');
      ga('send', 'pageview');

    </script>

  </body>
</html>